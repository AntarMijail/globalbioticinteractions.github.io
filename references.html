<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Global Biotic Interactions | References</title>
    <link rel="stylesheet" href="globi.css"/>
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.4/css/jquery.dataTables.min.css">

    <!-- jQuery -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.4/js/jquery.js"></script>

    <!-- DataTables -->
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.4/js/jquery.dataTables.min.js"></script>
    <script src="globi-data-dist.js"></script>
    <script src="menu.js"></script>
    <script type="text/javascript">
        window.onload = function () {
            buildMenu();
            loadStats();
        };
        $(document).ready(function () {
            $('#contributors').DataTable({
                paging: true,
                orderClasses: false,
                ajax: function (data, callback, settings) {
                    var rows = [];
                    globiData.findStudyStats({}, function (studyStatList) {
                        studyStatList.forEach(function (element) {
                            var row = [];
                            var link = (typeof element.url === 'undefined') ? '' : ' <a href="' + element.url + '" title="' + element.reference + '">link</a>';
                            link = (typeof element.doi === 'undefined') ? link : ' <a href="' + element.doi.replace(/^doi:/, 'https://dx.doi.org/') + '" title="' + element.reference + '">doi</a>';
                            row[0] = element.reference + link;
                            row[1] = element.totalInteractions;
                            row[2] = element.totalSourceTaxa;
                            row[3] = element.totalTargetTaxa;
                            row[4] = element.source;
                            rows[rows.length] = row;
                        });
                        callback({ data: rows });
                    });
                }});
        });

        var loadStats = function () {
            globiData.findStats({}, function (stats) {
                var elem = document.createElement('th');
                elem.setAttribute('colspan', '4');
                var interDiv = document.getElementById('interactions');
                interDiv.innerHTML = '(' + stats.totalInteractions + ' total)';
                var srcTaxa = document.getElementById('sourceTaxa');
                srcTaxa.innerHTML = '(' + stats.totalSourceTaxa + ' unique)';
                var tgtTaxa = document.getElementById('targetTaxa');
                tgtTaxa.innerHTML = '(' + stats.totalTargetTaxa + ' unique)';
                var references = document.getElementById('references');
                references.innerHTML = '(' + stats.numberOfStudies + ' total)';
                var references = document.getElementById('sources');
                references.innerHTML = '(' + stats.numberOfDistinctSources + ' total)';
            });
        };
    </script>
</head>
<body>
<div style="text-align: right"><a href="http://api.globalbioticinteractions.org/contributors.csv">download csv</a></div>
<br/>
<table id="contributors">
    <thead>
    <tr>
        <th width='40%'><b>reference</b></th>
        <th width='10%'><b>interactions</b></th>
        <th width='10%'><b>source taxa</b></th>
        <th width='10%'><b>target taxa</b></th>
        <th width='30%'><b>source</b></th>
    </tr>

    <tr>
        <th id="references">(...)</th>
        <th id="interactions">(...)</th>
        <th id="sourceTaxa">(...)</th>
        <th id="targetTaxa">(...)</th>
        <th id="sources">(...)</th>
    </tr>
    </thead>
    <tbody>
    </tbody>
</table>
</body>
</html>
