<!DOCTYPE html>
<html>
<head>
    <title>Spatial Search (Map)</title>
    <link rel="stylesheet" href="spatialsearch.css"/>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <script src="../vendor/markerclusterer.js"></script>
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <!--script src="globi-dist.js"></script-->
    <script src="spatialsearch.js"></script>
    <script src="areapicker.js"></script>
    <script>

        var showAreaInfos = function( element ) {
            var boundingBox = jQuery( element ).data( 'bounding-box' );



            var dataSetUrl = 'http://trophicgraph.com:8080/interaction?type=json.v2&' + boundingBox;

            d3.json( dataSetUrl, function( json ) {
                if ( json.length ) {

                    jQuery( '#tree-container, #dependency-wheel-container, #bundle-container' ).empty();
                    buildTree( json );

                    buildDependencyWheel( json );

                    buildBundles( json );
                }
            } );
        };

        jQuery( function() {
            var map = initializeMap(),
                markers = [],
                markerClusterer = null,
                areapicker = new AreaPicker( map );

            jQuery.ajax( { url: './locations.json' } ).done( function( locations ) {
                if ( locations ) {
                    for ( var index in locations ) {
                        if ( locations.hasOwnProperty( index ) ) {
                            var location = locations[ index ],
                                content = createLocationContent( location );
                            markers.push( placeMarker( content, location, map ) );
                        }
                    }
                    markerClusterer = initializeMarkerClusterer( map, markers );
                }
            } );


        } );
    </script>
    <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
    <!--<script type="text/javascript" src="../vendor/d3/d3.layout.js"></script>-->
    <script type="text/javascript" src="../vendor/d3/d3.dependencyWheel.js"></script>
    <script type="text/javascript" src="treeoflife.js"></script>
    <script type="text/javascript" src="dependencywheel.js"></script>
    <script type="text/javascript" src="bundle.js"></script>

    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
        }
        body, html {
            height: 100%;
            width: 100%;
        }
        #map, #tree, #dependency-wheel, #bundle {
            float: left;
            width: 50%;
            height: 50%;
            overflow: auto;
        }
        #map {
            background: #b7b7b7;
        }
        #tree {
            background: #dfdfdf;
        }
        #dependency-wheel {
            background: #dfdfdf;
        }
        #bundle {
            background: #b7b7b7;
        }

        #tree h3, #dependency-wheel h3, #bundle h3 {
            color: #cfcfcf;
            text-align: center;
            font-family: monospace;
            font-size: 1.5em;
        }
    </style>
    <style type="text/css">
        .node circle {
            cursor: pointer;
            fill: #fff;
            stroke: seagreen;
            stroke-width: 1.5px;
        }

        .node text {
            font-size: 10px;
            font: Helvetica, "Helvetica Neue", Arial, sans-serif;
        }

        path.link {
            fill: none;
            stroke: #eee;
            stroke-width: 1.5px;
        }

        path.inter-link {
            fill: none;
            stroke: #f00;
            stroke-width: 2px;
        }
    </style>
    <style type="text/css">
        .empty {
            background: #f00;
        }

        .dependencyWheel {
            font: 10px sans-serif;
        }
    </style>

    <style>

        .bundle-node {
            font: 10px "Helvetica Neue", Helvetica, Arial, sans-serif;
            fill: #333;
        }

        .bundle-node:hover {
            fill: #000;
        }

        .bundl-link {
            stroke: lightgreen;
            stroke-opacity: .4;
            fill: none;
            pointer-events: none;
        }

        .bundle-node:hover,
        .node--source,
        .node--target {
            font-weight: 400;
        }

        .node--source {
            fill: #2ca02c;
        }

        .node--target {
            fill: #d62728;
        }

        .link--source,
        .link--target {
            stroke-opacity: 1;
            stroke-width: 2px;
        }

        .link--source {
            stroke: #d62728;
        }

        .link--target {
            stroke: #2ca02c;
        }

    </style>
</head>
<body id="spatialsearch-index">
    <div id="map">&nbsp;</div>
    <div id="tree" style="zoom: 60%;"><h3>Tree view</h3><div id="tree-container"></div></div>
    <div id="dependency-wheel" style="zoom: 60%;"><h3>Dependency wheel</h3><div id="dependency-wheel-container"></div></div>
    <div id="bundle" style="zoom: 60%;"><h3>Bundle view</h3><div id="bundle-container"></div></div>
</body>
</html>